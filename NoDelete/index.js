(function(d,o,t,y,c,f,p,b,m){"use strict";t.storage.ignore??={users:[],bots:!1},t.storage.timestamps??=!1,t.storage.onlyTimestamps??=!1,t.storage.ew??=!1;function w(a){return y.useProxy(t.storage),o.React.createElement(o.ReactNative.ScrollView,{style:{flex:1}},[{type:"switch",label:"Show the time of deletion",setting:t.storage.timestamps,onChange(s){return t.storage.timestamps=s}},{type:"switch",label:"Use AM/PM",setting:t.storage.ew,onChange(s){return t.storage.ew=s}},{type:"separator"},{type:"switch",label:"Ignore bots",setting:t.storage.ignore.bots,onChange(s){return t.storage.ignore.bots=s}},{type:"text",label:"The plugin does not keep the messages you've deleted"}].map(function(s){if(s.type==="switch")return o.React.createElement(c.Forms.FormRow,{label:s.label,trailing:o.React.createElement(c.Forms.FormSwitch,{value:s.setting,onValueChange:s.onChange})});if(s.type==="text")return o.React.createElement(c.Forms.FormLabel,{label:s.label});if(s.type==="separator")return o.React.createElement(c.Forms.FormDivider,null)}))}const h="\u{E0134}";let u,l=[];var v={settings:w,patches:[],onUnload(){this.patches.forEach(function(a){return a()}),this.patches=[]},onLoad(){try{this.patches.push(f.before("dispatch",o.FluxDispatcher,function(s){try{u||(u=p.findByStoreName("MessageStore"));const e=s[0];if(!e||e?.type!=="MESSAGE_DELETE"||!e?.id||!e?.channelId)return;const r=u.getMessage(e.channelId,e.id);if(t.storage.ignore.users.includes(r?.author?.id)||t.storage.ignore.bots&&r?.author?.bot)return;if(l.includes(e.id))return l.splice(l.indexOf(e.id),1),s;l.push(e.id);let i=t.storage.message||"This message was deleted";return t.storage.timestamps&&(i+=` (${o.moment().format(t.storage.ew?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),s[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:e.channelId,messageId:e.id}},errorResponseBody:{code:2e5,message:i}},s}catch(e){console.error(e),alert(`[Nodelete \u2192 dispatcher patch] died
`+e.stack)}}));const a=f.before("render",p.findByProps("ScrollView").View,function(s){try{let e=b.findInReactTree(s,function(n){return n.key===".$UserProfileOverflow"});if(!e||!e.props||e.props.sheetKey!=="UserProfileOverflow")return;const r=e.props.content.props;if(r.options.find(function(n){return n?.label?.startsWith?.(h)}))return;console.log(e._owner);const i=Object.keys(e._owner.stateNode._keyChildMapping).find(function(n){return e._owner.stateNode._keyChildMapping[n]&&n.match(/(?<=\$UserProfile)\d+/)})?.slice?.(13);let g=+r.options[1].isDestructive;t.storage.ignore.users.includes(i)?(r.options[2].isDestructive&&g++,r.options.splice(g+1,0,{label:h+"[NoDelete] Stop ignoring deleted messages",onPress:function(){t.storage.ignore.users.splice(t.storage.ignore.users.findIndex(function(n){return n===i}),1),m.showToast(`Stopped ignoring deleted messages from ${r.header.title}`),r.hideActionSheet()}})):r.options.splice(g+1,0,{isDestructive:!0,label:h+"[NoDelete] Ignore deleted messages",onPress:function(){t.storage.ignore.users.push(i),m.showToast(`Ignoring deleted messages from ${r.header.title}`),r.hideActionSheet()}})}catch(e){let r=!1;try{r=a()}catch{r=!1}console.error(e),alert(`[NoDelete \u2192 user context menu patch] failed. Patch ${r?"dis":"en"}abled
`+e.stack)}});this.patches.push(a)}catch(a){console.error(a),alert(`[NoDelete] dead
`+a.stack)}}};return d.default=v,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro.common,vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.patcher,vendetta.metro,vendetta.utils,vendetta.ui.toasts);
