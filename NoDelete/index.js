(function(D,o,t,B,l,g,p,b,f){"use strict";t.storage.ignore??={users:[],bots:!1},t.storage.timestamps??=!1,t.storage.onlyTimestamps??=!1,t.storage.ew??=!1;function y(r){return B.useProxy(t.storage),o.React.createElement(o.ReactNative.ScrollView,{style:{flex:1}},[{type:"switch",label:"Show the time of deletion",setting:t.storage.timestamps,onChange(u){return t.storage.timestamps=u}},{type:"switch",label:"Use AM/PM",setting:t.storage.ew,onChange(u){return t.storage.ew=u}},{type:"separator"},{type:"switch",label:"Ignore bots",setting:t.storage.ignore.bots,onChange(u){return t.storage.ignore.bots=u}},{type:"text",label:"The plugin does not keep the messages you've deleted"}].map(function(u){if(u.type==="switch")return o.React.createElement(l.Forms.FormRow,{label:u.label,trailing:o.React.createElement(l.Forms.FormSwitch,{value:u.setting,onValueChange:u.onChange})});if(u.type==="text")return o.React.createElement(l.Forms.FormLabel,{label:u.label});if(u.type==="separator")return o.React.createElement(l.Forms.FormDivider,null)}))}const c={optionLabels:[{"en-GB":"[NoDelete] Ignore deleted messages",uk:"[NoDelete] \u0406\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u0442\u0438 \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0456 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044F",ru:"[NoDelete] \u0418\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"},{"en-GB":"[NoDelete] Stop ignoring deleted messages",uk:"[NoDelete] \u041F\u0440\u0438\u043F\u0438\u043D\u0438\u0442\u0438 \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0438\u0445 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044C",ru:"[NoDelete] \u041F\u0440\u0435\u043A\u0440\u0430\u0442\u0438\u0442\u044C \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439"}],toastLabels:[{"en-GB":"Enabled ignoring deleted messages from ${user}",uk:"\u0423\u0432\u0456\u043C\u043A\u043D\u0435\u043D\u043E \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0438\u0445 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u044C \u0432\u0456\u0434 ${user}",ru:"\u0412\u043A\u043B\u044E\u0447\u0435\u043D\u043E \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043E\u0442 ${user}"},{"en-GB":"Disabled ignoring deleted messages from ${user}",uk:"\u0412\u0438\u043C\u043A\u043D\u0435\u043D\u043E \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0438\u0445 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u044C \u0432\u0456\u0434 ${user}",ru:"\u0412\u044B\u043A\u043B\u044E\u0447\u0435\u043D\u043E \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043E\u0442 ${user}"}],thisMessageWasDeleted:{"en-GB":"This message was deleted",uk:"\u0426\u0435 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044F \u0431\u0443\u043B\u043E \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u043E",ru:"\u042D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u0431\u044B\u043B\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043E"}};let F="undefined";const w="en-GB";function i(r){let u=c;for(const e of r.split("."))u?.hasOwnProperty(e)?u=u[e]:u=c;return u===c?r:u[F]??u[w]??r}let h,d=[];var v={settings:y,patches:[],onUnload(){this.patches.forEach(function(r){return r()}),this.patches=[]},onLoad(){try{this.patches.push(g.before("dispatch",o.FluxDispatcher,function(u){try{h||(h=p.findByStoreName("MessageStore"));const e=u[0];if(!e||e?.type!=="MESSAGE_DELETE"||!e?.id||!e?.channelId)return;const s=h.getMessage(e.channelId,e.id);if(t.storage.ignore.users.includes(s?.author?.id)||t.storage.ignore.bots&&s?.author?.bot)return;if(d.includes(e.id))return d.splice(d.indexOf(e.id),1),u;d.push(e.id);let n=i("thisMessageWasDeleted");return t.storage.timestamps&&(n+=` (${o.moment().format(t.storage.ew?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),u[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:e.channelId,messageId:e.id}},errorResponseBody:{code:2e5,message:n}},u}catch(e){console.error(e),alert(`[Nodelete \u2192 dispatcher patch] died
`+e.stack)}}));const r=g.before("render",p.findByProps("ScrollView").View,function(u){try{let e=b.findInReactTree(u,function(a){return a.key===".$UserProfileOverflow"});if(!e||!e.props||e.props.sheetKey!=="UserProfileOverflow")return;const s=e.props.content.props;if(s.options.some(function(a){return c.optionLabels.some(function(m){return Object.values(m).includes(m?.label)})}))return;const n=Object.keys(e._owner.stateNode._keyChildMapping).find(function(a){return e._owner.stateNode._keyChildMapping[a]&&a.match(/(?<=\$UserProfile)\d+/)})?.slice?.(13);let E=+s.options[1].isDestructive;t.storage.ignore.users.includes(n)?(s.options[2].isDestructive&&E++,s.options.splice(E+1,0,{label:i("optionLabels.1"),onPress:function(){t.storage.ignore.users.splice(t.storage.ignore.users.findIndex(function(a){return a===n}),1),f.showToast(i("toastLabels.1").replaceAll("${user}",s.header.title)),s.hideActionSheet()}})):s.options.splice(E+1,0,{isDestructive:!0,label:i("optionLabels.0"),onPress:function(){t.storage.ignore.users.push(n),f.showToast(i("toastLabels.0").replaceAll("${user}",s.header.title)),s.hideActionSheet()}})}catch(e){console.error(e);let s=!1;try{s=r()}catch{s=!1}alert(`[NoDelete \u2192 context menu patch] failed. Patch ${s?"dis":"en"}abled
`+e.stack)}});this.patches.push(r)}catch(r){console.error(r),alert(`[NoDelete] dead
`+r.stack)}}};return D.default=v,Object.defineProperty(D,"__esModule",{value:!0}),D})({},vendetta.metro.common,vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.patcher,vendetta.metro,vendetta.utils,vendetta.ui.toasts);
