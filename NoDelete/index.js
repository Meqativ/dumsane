(function(n,s,t,l,r,h,g){"use strict";t.storage.ignore??={users:[],bots:!1},t.storage.timestamps??=!1,t.storage.onlyTimestamps??=!1,t.storage.ew??=!1;function m(a){return l.useProxy(t.storage),s.React.createElement(s.ReactNative.ScrollView,{style:{flex:1}},[{type:"switch",label:"Show the time of deletion",setting:t.storage.timestamps,onChange(e){return t.storage.timestamps=e}},{type:"switch",label:"Use AM/PM",setting:t.storage.ew,onChange(e){return t.storage.ew=e}},{type:"separator"},{type:"switch",label:"Ignore bots",setting:t.storage.ignore.bots,onChange(e){return t.storage.ignore.bots=e}},{type:"text",label:"The plugin does not keep the messages you've deleted"}].map(function(e){if(e.type==="switch")return s.React.createElement(r.Forms.FormRow,{label:e.label,trailing:s.React.createElement(r.Forms.FormSwitch,{value:e.setting,onValueChange:e.onChange})});if(e.type==="text")return s.React.createElement(r.Forms.FormLabel,{label:e.label});if(e.type==="separator")return s.React.createElement(r.Forms.FormDivider,null)}))}let i,o=[];var u={settings:m,patches:[],onUnload(){this.patches.forEach(function(a){return a()}),this.patches=[]},onLoad(){try{this.patches.push(h.before("dispatch",s.FluxDispatcher,function(a){try{i||(i=g.findByStoreName("MessageStore"));const e=a[0];if(!e||e?.type!=="MESSAGE_DELETE"||!e?.id||!e?.channelId)return;const c=i.getMessage(e.channelId,e.id);if(t.storage.ignore.users.includes(c?.author?.id)||t.storage.ignore.bots&&c?.author?.bot)return;if(o.includes(e.id))return o.splice(o.indexOf(e.id),1),a;o.push(e.id);let d=t.storage.message||"This message was deleted";return t.storage.timestamps&&(d+=` (${s.moment().format(t.storage.ew?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),a[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:e.channelId,messageId:e.id}},errorResponseBody:{code:2e5,message:d}},a}catch(e){console.error(e),alert(`[Nodelete \u2192 patch] died
`+e.stack)}}))}catch(a){console.error(a),alert(`[NoDelete] dead
`+a.stack)}}};return n.default=u,Object.defineProperty(n,"__esModule",{value:!0}),n})({},vendetta.metro.common,vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.patcher,vendetta.metro);
