(function(D,r,t,B,p,o,b,f,m,w,F){"use strict";t.storage.ignore??={users:[],bots:!1},t.storage.timestamps??=!1,t.storage.onlyTimestamps??=!1,t.storage.ew??=!1;function y(a){return B.useProxy(t.storage),r.React.createElement(r.ReactNative.ScrollView,{style:{flex:1}},r.React.createElement(o.Forms.FormSection,{title:"Settings",titleStyleType:"no_border"},r.React.createElement(o.Forms.FormRow,{label:"Show the time of deletion",trailing:r.React.createElement(o.Forms.FormSwitch,{value:t.storage.timestamps,onValueChange:function(u){return t.storage.timestamps=u}})}),r.React.createElement(o.Forms.FormRow,{label:"Use AM/PM",trailing:r.React.createElement(o.Forms.FormSwitch,{value:t.storage.ew,onValueChange:function(u){return t.storage.ew=u}})}),r.React.createElement(o.Forms.FormRow,{label:"The plugin does not keep the messages you've deleted"})),r.React.createElement(o.Forms.FormSection,{title:"Filters"},r.React.createElement(o.Forms.FormRow,{label:"Ignore bots",trailing:r.React.createElement(o.Forms.FormSwitch,{value:t.storage.ignore.bots,onValueChange:function(u){return t.storage.ignore.bots=u}})}),r.React.createElement(o.Forms.FormRow,{label:`You have ${t.storage.ignore.users.length} user${t.storage.ignore.users===1?"":"s"} ignored`,trailing:r.React.createElement(o.Forms.FormRow.Icon,{source:b.getAssetIDByName("ic_trash_24px")}),onPress:function(){const u=t.storage?.ignore;u&&typeof u.users<"u"&&u.users.length!==0&&p.showConfirmationAlert({title:"Are you sure?",content:`This will clear all users (${u.users.length}) you have added to the ignore list. Do you want to proceed?`,confirmText:"Yes",cancelText:"Cancel",confirmColor:"brand",onConfirm:function(){u.users=[]}})}})))}const l={optionLabels:[{"en-GB":"[NoDelete] Ignore deleted messages",uk:"[NoDelete] \u0406\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u0442\u0438 \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0456 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044F",ru:"[NoDelete] \u0418\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"},{"en-GB":"[NoDelete] Stop ignoring deleted messages",uk:"[NoDelete] \u041F\u0440\u0438\u043F\u0438\u043D\u0438\u0442\u0438 \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0438\u0445 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044C",ru:"[NoDelete] \u041F\u0440\u0435\u043A\u0440\u0430\u0442\u0438\u0442\u044C \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439"}],toastLabels:[{"en-GB":"Enabled ignoring deleted messages from ${user}",uk:"\u0423\u0432\u0456\u043C\u043A\u043D\u0435\u043D\u043E \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0438\u0445 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u044C \u0432\u0456\u0434 ${user}",ru:"\u0412\u043A\u043B\u044E\u0447\u0435\u043D\u043E \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043E\u0442 ${user}"},{"en-GB":"Disabled ignoring deleted messages from ${user}",uk:"\u0412\u0438\u043C\u043A\u043D\u0435\u043D\u043E \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0438\u0445 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u044C \u0432\u0456\u0434 ${user}",ru:"\u0412\u044B\u043A\u043B\u044E\u0447\u0435\u043D\u043E \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043E\u0442 ${user}"}],thisMessageWasDeleted:{"en-GB":"This message was deleted",uk:"\u0426\u0435 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044F \u0431\u0443\u043B\u043E \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u043E",ru:"\u042D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u0431\u044B\u043B\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043E"}};let v="undefined";const S="en-GB";function i(a){let u=l;for(const e of a.split("."))u?.hasOwnProperty(e)?u=u[e]:u=l;return u===l?a:u[v]??u[S]??a}let h,c=[];var C={settings:y,patches:[],onUnload(){this.patches.forEach(function(a){return a()}),this.patches=[]},onLoad(){try{this.patches.push(f.before("dispatch",r.FluxDispatcher,function(u){try{h||(h=m.findByStoreName("MessageStore"));const e=u[0];if(!e||e?.type!=="MESSAGE_DELETE"||!e?.id||!e?.channelId)return;const s=h.getMessage(e.channelId,e.id);if(t.storage.ignore.users.includes(s?.author?.id)||t.storage.ignore.bots&&s?.author?.bot)return;if(c.includes(e.id))return c.splice(c.indexOf(e.id),1),u;c.push(e.id);let d=i("thisMessageWasDeleted");return t.storage.timestamps&&(d+=` (${r.moment().format(t.storage.ew?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),u[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:e.channelId,messageId:e.id}},errorResponseBody:{code:2e5,message:d}},u}catch(e){console.error(e),alert(`[Nodelete \u2192 dispatcher patch] died
`+e.stack)}}));const a=f.before("render",m.findByProps("ScrollView").View,function(u){try{let e=w.findInReactTree(u,function(n){return n.key===".$UserProfileOverflow"});if(!e||!e.props||e.props.sheetKey!=="UserProfileOverflow")return;const s=e.props.content.props,d=l.optionLabels.map(Object.values).flat();if(s.options.some(function(n){return d.includes(n?.label)}))return;const E=Object.keys(e._owner.stateNode._keyChildMapping).find(function(n){return e._owner.stateNode._keyChildMapping[n]&&n.match(/(?<=\$UserProfile)\d+/)})?.slice?.(13);let g=+s.options?.[1]?.isDestructive;t.storage.ignore.users.includes(E)?(s.options?.[2]?.isDestructive&&g++,s.options.splice(g+1,0,{label:i("optionLabels.1"),onPress:function(){t.storage.ignore.users.splice(t.storage.ignore.users.findIndex(function(n){return n===E}),1),F.showToast(i("toastLabels.1").replaceAll("${user}",s.header.title)),s.hideActionSheet()}})):s.options.splice(g+1,0,{isDestructive:!0,label:i("optionLabels.0"),onPress:function(){t.storage.ignore.users.push(E),F.showToast(i("toastLabels.0").replaceAll("${user}",s.header.title)),s.hideActionSheet()}})}catch(e){console.error(e);let s=!1;try{s=a()}catch{s=!1}alert(`[NoDelete \u2192 context menu patch] failed. Patch ${s?"dis":"en"}abled
`+e.stack)}});this.patches.push(a)}catch(a){console.error(a),alert(`[NoDelete] dead
`+a.stack)}}};return D.default=C,Object.defineProperty(D,"__esModule",{value:!0}),D})({},vendetta.metro.common,vendetta.plugin,vendetta.storage,vendetta.ui.alerts,vendetta.ui.components,vendetta.ui.assets,vendetta.patcher,vendetta.metro,vendetta.utils,vendetta.ui.toasts);
