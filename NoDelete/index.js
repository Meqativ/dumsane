(function(h,s,t,p,b,a,v,g,F,w,m){"use strict";t.storage.ignore??={users:[],bots:!1},t.storage.timestamps??=!1,t.storage.onlyTimestamps??=!1,t.storage.ew??=!1;function y(o){return p.useProxy(t.storage),s.React.createElement(s.ReactNative.ScrollView,{style:{flex:1}},s.React.createElement(a.Forms.FormSection,{title:"Settings",titleStyleType:"no_border"},s.React.createElement(a.Forms.FormRow,{label:"Show the time of deletion",trailing:s.React.createElement(a.Forms.FormSwitch,{value:t.storage.timestamps,onValueChange:function(u){return t.storage.timestamps=u}})}),s.React.createElement(a.Forms.FormRow,{label:"Use AM/PM",trailing:s.React.createElement(a.Forms.FormSwitch,{value:t.storage.ew,onValueChange:function(u){return t.storage.ew=u}})}),s.React.createElement(a.Forms.FormRow,{label:"The plugin does not keep the messages you've deleted"})),s.React.createElement(a.Forms.FormSection,{title:"Filters"},s.React.createElement(a.Forms.FormRow,{label:"Ignore bots",trailing:s.React.createElement(a.Forms.FormSwitch,{value:t.storage.ignore.bots,onValueChange:function(u){return t.storage.ignore.bots=u}})}),s.React.createElement(a.Forms.FormRow,{label:`You have ${t.storage.ignore.users.length} user${t.storage.ignore.users===1?"":"s"} ignored`,trailing:s.React.createElement(a.Forms.FormRow.Icon,{source:v.getAssetIDByName("ic_trash_24px")}),onPress:function(){const u=t.storage?.ignore;u&&typeof u.users<"u"&&u.users.length!==0&&b.showConfirmationAlert({title:"Are you sure?",content:`This will clear all users (${u.users.length}) you have added to the ignore list. Do you want to proceed?`,confirmText:"Yes",cancelText:"Cancel",confirmColor:"brand",onConfirm:function(){u.users=[]}})}})))}const l={optionLabels:[{"en-GB":"Add to NoDelete ignore list",uk:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u0438 \u0434\u043E \u0441\u043F\u0438\u0441\u043A\u0443 \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F NoDelete",ru:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F NoDelete"},{"en-GB":"Remove from the NoDelete ignore list",uk:"\u041F\u0440\u0438\u0431\u0440\u0430\u0442\u0438 \u0437 \u0441\u043F\u0438\u0441\u043A\u0443 \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F NoDelete",ru:"\u0423\u0431\u0440\u0430\u0442\u044C \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F NoDelete"}],toastLabels:[{"en-GB":"Added ${user} to the ignore list",uk:"${user} \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u0434\u043E \u0441\u043F\u0438\u0441\u043A\u0443 \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F",ru:"${user} \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u044B \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F"},{"en-GB":"Removed ${user} from the ignore list",uk:"${user} \u043F\u0440\u0438\u0431\u0440\u0430\u043D\u043E \u0437\u0456 \u0441\u043F\u0438\u0441\u043A\u0443 \u0456\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u043D\u043D\u044F",ru:"${user} \u0443\u0431\u0440\u0430\u043D\u044B \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F"}],thisMessageWasDeleted:{"en-GB":"This message was deleted",uk:"\u0426\u0435 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u043B\u0435\u043D\u043D\u044F \u0431\u0443\u043B\u043E \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u043E",ru:"\u042D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u0431\u044B\u043B\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043E"}};let R="undefined";const A="en-GB";function i(o){let u=l;for(const e of o.split("."))u?.hasOwnProperty(e)?u=u[e]:u=l;return u===l?o:u[R]??u[A]??o}let f,c=[];var S={settings:y,patches:[],onUnload(){this.patches.forEach(function(o){return o()}),this.patches=[]},onLoad(){try{this.patches.push(g.before("dispatch",s.FluxDispatcher,function(u){try{f||(f=F.findByStoreName("MessageStore"));const e=u[0];if(!e||e?.type!=="MESSAGE_DELETE"||!e?.id||!e?.channelId)return;const r=f.getMessage(e.channelId,e.id);if(t.storage.ignore.users.includes(r?.author?.id)||t.storage.ignore.bots&&r?.author?.bot)return;if(c.includes(e.id))return c.splice(c.indexOf(e.id),1),u;c.push(e.id);let d=i("thisMessageWasDeleted");return t.storage.timestamps&&(d+=` (${s.moment().format(t.storage.ew?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),u[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:e.channelId,messageId:e.id}},errorResponseBody:{code:2e5,message:d}},u}catch(e){console.error(e),alert(`[Nodelete \u2192 dispatcher patch] died
`+e.stack)}}));const o=g.before("render",F.findByProps("ScrollView").View,function(u){try{let e=w.findInReactTree(u,function(n){return n.key===".$UserProfileOverflow"});if(!e||!e.props||e.props.sheetKey!=="UserProfileOverflow")return;const r=e.props.content.props,d=l.optionLabels.map(Object.values).flat();if(r.options.some(function(n){return d.includes(n?.label)}))return;const E=Object.keys(e._owner.stateNode._keyChildMapping).find(function(n){return e._owner.stateNode._keyChildMapping[n]&&n.match(/(?<=\$UserProfile)\d+/)})?.slice?.(13);let D=+r.options?.[1]?.isDestructive;t.storage.ignore.users.includes(E)?(r.options?.[2]?.isDestructive&&D++,r.options.splice(D+1,0,{label:i("optionLabels.1"),onPress:function(){t.storage.ignore.users.splice(t.storage.ignore.users.findIndex(function(n){return n===E}),1),m.showToast(i("toastLabels.1").replaceAll("${user}",r.header.title)),r.hideActionSheet()}})):r.options.splice(D+1,0,{isDestructive:!0,label:i("optionLabels.0"),onPress:function(){t.storage.ignore.users.push(E),m.showToast(i("toastLabels.0").replaceAll("${user}",r.header.title)),r.hideActionSheet()}})}catch(e){console.error(e);let r=!1;try{r=o()}catch{r=!1}alert(`[NoDelete \u2192 context menu patch] failed. Patch ${r?"dis":"en"}abled
`+e.stack)}});this.patches.push(o)}catch(o){console.error(o),alert(`[NoDelete] dead
`+o.stack)}}};return h.default=S,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro.common,vendetta.plugin,vendetta.storage,vendetta.ui.alerts,vendetta.ui.components,vendetta.ui.assets,vendetta.patcher,vendetta.metro,vendetta.utils,vendetta.ui.toasts);
