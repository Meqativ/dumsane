(function(E,D,S,y,_){"use strict";function x(e,o,t){if(!e.name||!e?.description)throw new Error(`No name(${e?.name}) or description(${e?.description}) in the passed command (command name: ${e?.name})`);if(e.displayName??=o?.names?.[t]??e.name,e.displayDescription??=o?.names?.[t]??e.description,e.options){if(!Array.isArray(e.options))throw new Error(`Options is not an array (received: ${typeof e.options})`);for(var r=0;r<e.options.length;r++){const s=e.options[r];if(!s?.name||!s?.description)throw new Error(`No name(${s?.name}) or description(${s?.description} in the option with index ${r}`);if(s.displayName??=o?.options?.[r]?.names?.[t]??s.name,s.displayDescription??=o?.options?.[r]?.descriptions?.[t]??s.description,s?.choices){if(!Array.isArray(s?.choices))throw new Error(`Choices is not an array (received: ${typeof s.choices})`);for(var n=0;n<s.choices.length;n++){const a=s.choices[n];if(!a?.name)throw new Error(`No name of choice with index ${n} in option with index ${r}`);a.displayName??=o?.options?.[r]?.choices?.[n]?.names?.[t]??a.name}}}}return e}function I(e,o){if(e.length!==o.length)return!1;for(let t=0;t<e.length;t++){const r=e[t],n=o[t];if(Array.isArray(r)&&Array.isArray(n)){if(!isArraysEqual(r,n))return!1}else if(typeof r=="object"&&typeof n=="object"){if(!isArraysEqual(Object.values(r),Object.values(n)))return!1}else if(r!==n)return!1}return!0}function k(e,o,t){if(o.some(function(n){return Array.isArray(n)?I(n,e):n===e}))return t;if(typeof e!="object")return e;const r=Array.isArray(e)?[]:{};for(const n in e)Array.isArray(e[n])?r[n]=k(e[n],o,t):o.includes(e[n])?r[n]=t:r[n]=k(e[n],o,t);return r}function L(e){const{metro:o}=e,{receiveMessage:t}=o.findByProps("sendMessage","receiveMessage"),{createBotMessage:r}=o.findByProps("createBotMessage"),n=o.findByProps("BOT_AVATARS");return function(s,a){if(s.channelId??=o.findByStoreName("SelectedChannelStore").getChannelId(),[null,void 0].includes(s.channelId))throw new Error("No channel id to receive the message into (channelId)");a!==void 0&&"author"in a&&"avatar"in a.author&&"avatarURL"in a.author&&(n.BOT_AVATARS[a.author.avatar]=a.author.avatarURL,delete a.author.avatarURL);let l=a===!0?s:r(s);return typeof a=="object"&&(l=e.metro.findByProps("merge").merge(l,a)),t(s.channelId,l),l}}function P(e,o){const t=[e?.constructor?.name];if(t[0]??="Undefined",t[0]!=="Undefined"&&e?.prototype?.constructor===e&&typeof e=="function")console.log("h"),t[0]="Class",t[1]=`(${e.name})`;else if(e===null)t[1]="null";else if(["symbol","function"].includes(typeof e)&&e?.name)t[1]=`(${e.name})`;else if(typeof e=="boolean")t[1]=`${e}`;else if(typeof e=="string")t[1]=e.length;else if(typeof e=="number"&&e!==0){const r=e.toExponential();r.endsWith("e+1")||(t[1]=r)}return t.join(" ")}function B(e,o){if(e===void 0)throw new Error("No object passed to make defaults for");if(o===void 0)throw new Error("No defaults object passed to make defaults off of");for(const t of Object.keys(o))typeof o[t]=="object"&&!Array.isArray(o[t])?(typeof e[t]!="object"&&(e[t]={}),B(e[t],o[t])):e[t]??=o[t]}const q={command:"https://cdn.discordapp.com/attachments/1099116247364407337/1112129955053187203/command.png"},{inspect:H}=S.findByProps("inspect"),V={author:{username:"eval",avatar:"command",avatarURL:q.command}},W=async function(){}.constructor,G="\u{E0134}";console.log("eval",vendetta.plugin.storage),B(vendetta.plugin.storage,{stats:{commandUseSessions:[],runs:{history:[],failed:0,succeeded:0,plugin:0,sessionHistory:[]}},settings:{history:{enabled:!0,saveContext:!1,saveOnError:!1,checkLatestDupes:!0},output:{location:0,trim:15e3,sourceEmbed:!0,info:{enabled:!0,prettyTypeof:!0,hints:!0},useToString:!1,inspect:{showHidden:!1,depth:3,maxArrayLength:15,compact:2,numericSeparator:!0,getters:!1},codeblock:{enabled:!0,escape:!0,language:`js
`},errors:{trim:!0,stack:!0}},defaults:{await:!0,global:!1,silent:!1}}});const{meta:{resolveSemanticColor:F}}=S.findByProps("colors","meta"),K=S.findByStoreName("ThemeStore"),w=function(e){return parseInt(F(K.theme,_.semanticColors.BACKGROUND_SECONDARY).slice(1),16)};let N,$,b={status:!1,position:-1};function U(){return window.sendMessage?window.sendMessage?.(...arguments):(N||(N=L(vendetta)),N(...arguments))}async function Y(e,o,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n,s=!1,a=+new Date;try{const d=[];t||d.push(...Object.keys(r)),d.push(e);let g=new W(...d),C=0;for(var l of Object.keys(r))d[C]=r[l],C++;o?n=await g(...d):n=g(...d)}catch(d){n=d,s=!0}let p=+new Date;return{result:n,errored:s,start:a,end:p,elapsed:p-a}}$={meta:vendetta.plugin,patches:[],onUnload(){this.patches.forEach(function(e){return e()}),this.patches=[]},onLoad(){y.storage.stats.runs.plugin++;let e;try{this.patches.push(D.registerCommand({...this.command,async execute(o,t){e??=S.findByStoreName("UserStore"),b.status||(b.status=!0,b.position=y.storage.stats.commandUseSessions.length+1,y.storage.stats.commandUseSessions.length===0&&(y.storage.stats.commandUseSessions=[0],b.position=0));const r=e.getCurrentUser(),n={...V,interaction:{name:"/"+this.displayName,user:r}},s={messageMods:n,...t,user:r,args:new Map(o.map(function(a){return[a.name,a]})),rawArgs:o,plugin:$};try{const{channel:a,args:l}=s,p=l.get("code")?.value;if(typeof p!="string")throw new Error("No code argument passed");const d=y.storage.settings,g=d.defaults,C=l.get("await")?.value??g.await,J=l.get("silent")?.value??g.silent,Q=l.get("global")?.value??g.global,{result:f,errored:h,start:X,end:Z,elapsed:R}=await Y(p,C,Q,{interaction:s}),{runs:m,commandUseSessions:T}=y.storage.stats,O=d.history;let v;if(O.enabled){const i=b.position;v={session:i,position:T[i],start:X,end:Z,elapsed:R,code:p,errored:h},s.dontSaveResult||(v.result=k(f,[m.history,m.sessionHistory,vendetta.plugin.storage],"not saved"),O.saveContext&&(v.context=k(s,[m.history,m.sessionHistory,vendetta.plugin.storage],"not saved"))),function(){if(!O.saveOnError&&h)return m.failed++;m.succeeded++,m.history.push(v),m.sessionHistory.push(v),T[v.session]++}()}if(!J){const i=d.output;let c=i.useToString?f.toString():H(f,i.inspect);if(h){const u=i.errors;u.stack&&(c=f.stack),u.trim&&(c=c.split("    at ?anon_0_?anon_0_evaluate")[0])}typeof i.trim=="number"&&i.trim<c.length&&(c=c.slice(0,i.trim)),i.codeblock.enabled&&(i.codeblock.escape&&(c=c.replace("```","`"+G+"``")),c="```"+i.codeblock.language+c+"```");let A;if(i.info.enabled){let u=i.info.prettyTypeof?P(f):"type: "+typeof f;h&&(u=`Error (${u})`);const ee=i.info.hints&&f==="undefined"&&!p.includes("return")?`hint: use the return keyword
`:"";A=`${u}
${ee}took: ${R}ms`}let j=`length: ${p.length}`,M=p.split("").filter(function(u){return u===`
`}).length;M<0&&(j+=`
newlines: ${M}`),h&&U({channelId:a.id,content:i.location?void 0:c,embeds:[{type:"rich",color:w("exploded"),title:"Error returned",description:i.location?c:i.info.enabled?A:void 0,footer:i.info.enabled&&i.location?{infoString:A}:void 0},i.sourceEmbed?{type:"rich",color:w("source"),title:"Code",description:p,footer:{text:j}}:void 0].filter(function(u){return u!==void 0})},n),h||U({channelId:a.id,content:i.location?void 0:c,embeds:[{type:"rich",color:w("satisfactory"),description:i.location?c:i.info.enabled?A:void 0,footer:i.info.enabled&&i.location?{infoString:A}:void 0},i.sourceEmbed?{type:"rich",color:w("source"),title:"Code",description:p,footer:{text:j}}:void 0].filter(function(u){return u!==void 0})},n)}if(!h&&l.get("return")?.value)return f}catch(a){console.error(a),console.log(a.stack),alert(`An uncatched error was thrown while running /eval
`+a.stack)}}}))}catch(o){console.error(o),console.log(o.stack),alert(`There was an error while loading the plugin "${$.meta.name}"
${o.stack}`)}},command:x({type:1,inputType:1,applicationId:"-1",name:"!eval",displayName:"!eval",description:"Evaluates code",options:[{required:!0,type:3,name:"code",description:"Code to evaluate"},{type:5,name:"return",description:"Return the returned value? (so it works as a real command)"},{type:5,name:"global",description:"Evaluate the code in the global scope?"},{type:5,name:"silent",description:"Show the output of the evaluation? (default: false)"},{type:5,name:"await",description:"await the evaluation?"}]})};var z=$;return E.EMBED_COLOR=w,E.default=z,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.ui);
