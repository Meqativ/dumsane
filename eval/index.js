(function(v,R,w,p,D){"use strict";function _(e,n,t){if(!e.name||!e?.description)throw new Error(`No name(${e?.name}) or description(${e?.description}) in the passed command (command name: ${e?.name})`);if(e.displayName??=n?.names?.[t]??e.name,e.displayDescription??=n?.names?.[t]??e.description,e.options){if(!Array.isArray(e.options))throw new Error(`Options is not an array (received: ${typeof e.options})`);for(var r=0;r<e.options.length;r++){const a=e.options[r];if(!a?.name||!a?.description)throw new Error(`No name(${a?.name}) or description(${a?.description} in the option with index ${r}`);if(a.displayName??=n?.options?.[r]?.names?.[t]??a.name,a.displayDescription??=n?.options?.[r]?.descriptions?.[t]??a.description,a?.choices){if(!Array.isArray(a?.choices))throw new Error(`Choices is not an array (received: ${typeof a.choices})`);for(var i=0;i<a.choices.length;i++){const o=a.choices[i];if(!o?.name)throw new Error(`No name of choice with index ${i} in option with index ${r}`);o.displayName??=n?.options?.[r]?.choices?.[i]?.names?.[t]??o.name}}}}return e}function x(e){const{metro:n}=e,{receiveMessage:t}=n.findByProps("sendMessage","receiveMessage"),{createBotMessage:r}=n.findByProps("createBotMessage"),i=n.findByProps("BOT_AVATARS");return function(a,o){if(a.channelId??=n.findByStoreName("SelectedChannelStore").getChannelId(),[null,void 0].includes(a.channelId))throw new Error("No channel id to receive the message into (channelId)");o!==void 0&&"author"in o&&"avatar"in o.author&&"avatarURL"in o.author&&(i.BOT_AVATARS[o.author.avatar]=o.author.avatarURL,delete o.author.avatarURL);let l=o===!0?a:r(a);return typeof o=="object"&&(l=e.metro.findByProps("merge").merge(l,o)),t(a.channelId,l),l}}function I(e,n){const t=[e?.constructor?.name];if(t[0]??="Undefined",t[0]!=="Undefined"&&e?.prototype?.constructor===e&&typeof e=="function")console.log("h"),t[0]="Class",t[1]=`(${e.name})`;else if(e===null)t[1]="null";else if(["symbol","function"].includes(typeof e)&&e?.name)t[1]=`(${e.name})`;else if(typeof e=="boolean")t[1]=`${e}`;else if(typeof e=="string")t[1]=string.length;else if(typeof e=="number"&&e!==0){const r=e.toExponential();r.endsWith("e+1")||(t[1]=r)}return t.join(" ")}function B(e,n){if(e===void 0)throw new Error("No object passed to make defaults for");if(n===void 0)throw new Error("No defaults object passed to make defaults off of");for(const t of Object.keys(n))typeof n[t]=="object"&&!Array.isArray(n[t])?(e[t]={},B(e[t],n[t])):e[t]??=n[t]}const L={command:"https://cdn.discordapp.com/attachments/1099116247364407337/1112129955053187203/command.png"},{inspect:j}=w.findByProps("inspect"),P={author:{username:"eval",avatar:"command",avatarURL:L.command}},H=async function(){}.constructor,V="\u{E0134}";p.storage.settings.saveHistory===!0&&(vendetta.plugin.storage={}),vendetta.plugin.storage={},B(vendetta.plugin.storage,{stats:{commandUseSessions:[],runs:{history:[],failed:0,succeeded:0,plugin:0,sessionHistory:[]}},settings:{history:{enabled:!0,saveContext:!1,saveOnError:!1,checkLatestDupes:!0},output:{location:0,trim:15e3,sourceEmbed:!0,info:{enabled:!0,prettyTypeof:!0,hints:!0},useToString:!1,inspect:{showHidden:!1,depth:2,maxArrayLength:15,compact:2,numericSeparator:!0,getters:!1},codeblock:{enabled:!0,escape:!0,language:`js
`},errors:{trim:!0,stack:!0}},defaults:{type:0,global:!1,silent:!1}}});const{meta:{resolveSemanticColor:q}}=w.findByProps("colors","meta"),G=w.findByStoreName("ThemeStore"),h=function(e){return parseInt(q(G.theme,D.semanticColors.BACKGROUND_SECONDARY).slice(1),16)};let $,b,E={status:!1,position:-1};function U(){return window.sendMessage?window.sendMessage?.(...arguments):($||($=x(vendetta)),$(...arguments))}async function K(e,n,t,r){let i,a=!1,o=+new Date;try{let c=new(n?H:Function)(e);t||(c=c.bind(r)),n?i=await c():i=c()}catch(c){i=c,a=!0}let l=+new Date;return{result:i,errored:a,start:o,end:l,elapsed:l-o}}b={meta:vendetta.plugin,patches:[],storage:p.storage,onUnload(){this.patches.forEach(function(e){return e()}),this.patches=[]},onLoad(){p.storage.stats.runs.plugin++;let e;try{this.patches.push(R.registerCommand({...this.command,async execute(n,t){e??=w.findByStoreName("UserStore"),E.status||(E.status=!0,E.position=p.storage.stats.commandUseSessions.length,p.storage.stats.commandUseSessions.length===0&&(p.storage.stats.commandUseSessions=[0]));const r=e.getCurrentUser(),i={...P,interaction:{name:"/"+this.displayName,user:r}},a={messageMods:i,...t,user:r,args:new Map(n.map(function(o){return[o.name,o]})),rawArgs:n,plugin:b};try{const{channel:o,args:l}=a,c=l.get("code")?.value;if(typeof c!="string")throw new Error("No code argument passed");const k=p.storage.settings,A=k.defaults,W=l.get("type")?.value??A.type,Y=l.get("silent")?.value??A.silent,z=l.get("global")?.value??A.global,{result:f,errored:m,start:J,end:Q,elapsed:T}=await K(c,W,z,{interaction:a}),{runs:S,commandUseSessions:O}=p.storage.stats,C=k.history;let y;if(C.enabled){const s=E.position;y={session:s,position:O[s],start:J,end:Q,elapsed:T,code:c,result:f,errored:m},C.saveContext&&(y.context=a),function(){if(!C.saveOnError&&m)return S.failed++;S.succeeded++,S.history.push(y),S.sessionHistory.push(y),O[y.session]++}()}if(!Y){const s=k.output;let d=s.useToString?f.toString():j(f,s.inspect);if(m){const u=s.errors;u.stack&&(d=f.stack),u.trim&&(d=d.split("    at ?anon_0_?anon_0_evaluate")[0])}typeof s.trim=="number"&&s.trim<d.length&&(d=d(0,s.trim)),s.codeblock.enabled&&(s.codeblock.escape&&(d=d.replace("```","`"+V+"``")),d="```"+s.codeblock.language+d+"```");let g;if(s.info.enabled){let u=s.info.prettyTypeof?I(f):typeof f;m&&(u=`Error (${u})`);const X=s.info.hints&&f==="undefined"&&!c.includes("return")?`hint: use the return keyword
`:"";g=`${u}
${X}took: ${T}ms`}let N=`length: ${c.length}`,M=c.split("").filter(function(u){return u===`
`}).length;M<0&&(N+=`
newlines: ${M}`),m&&U({channelId:o.id,content:s.location?void 0:d,embeds:[{type:"rich",color:h("exploded"),title:"Error returned",description:s.location?d:s.info.enabled?g:void 0,footer:s.info.enabled&&s.location?{infoString:g}:void 0},s.sourceEmbed?{type:"rich",color:h("source"),title:"Code",description:c,footer:{text:N}}:void 0].filter(function(u){return u!==void 0})},i),m||U({channelId:o.id,content:s.location?void 0:d,embeds:[{type:"rich",color:h("satisfactory"),description:s.location?d:s.info.enabled?g:void 0,footer:s.info.enabled&&s.location?{infoString:g}:void 0},s.sourceEmbed?{type:"rich",color:h("source"),title:"Code",description:c,footer:{text:N}}:void 0].filter(function(u){return u!==void 0})},i)}if(!m&&l.get("return")?.value)return f}catch(o){console.error(o),console.log(o.stack),alert(`An uncatched error was thrown while running /eval
`+o.stack)}}}))}catch(n){console.error(n),console.log(n.stack),alert(`There was an error while loading the plugin "${b.meta.name}"
${n.stack}`)}},command:_({type:1,inputType:1,applicationId:"-1",name:"!eval",displayName:"!eval",description:"Evaluates code",options:[{required:!0,type:3,name:"code",description:"Code to evaluate"},{type:4,name:"type",description:"Type of the code",choices:[{name:"sync",value:0},{name:"async [default]",value:1}]},{type:5,name:"return",description:"Return the returned value? (so it works as a real command, default: false)"},{type:5,name:"global",description:"Evaluate the code in the global scope? (default: false)"},{type:5,name:"silent",description:"Show the output of the evaluation? (default: false)"}]})};var F=b;return v.EMBED_COLOR=h,v.default=F,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.ui);
