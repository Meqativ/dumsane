(function(p,A,B,h,C,N,U,$){"use strict";function b(e){const{metro:{findByProps:s,findByStoreName:i,common:{lodash:{merge:o}}}}=e,t=s("_sendMessage"),{createBotMessage:n}=s("createBotMessage"),r=s("BOT_AVATARS"),{getChannelId:u}=i("SelectedChannelStore");return function(l,a){if(l.channelId??=u(),[null,void 0].includes(l.channelId))throw new Error("No channel id to receive the message into (channelId)");let d=l;if(l.really){typeof a=="object"&&(d=o(d,a));const c=[d,{}];c[0].tts??=!1;for(const f of["allowedMentions","messageReference"])f in c[0]&&(c[1][f]=c[0][f],delete c[0][f]);const g="overwriteSendMessageArg2";return g in c[0]&&(c[1]=c[0][g],delete c[0][g]),t._sendMessage(l.channelId,...c)}return a!==!0&&(d=n(d)),typeof a=="object"&&(d=o(d,a),"author"in a&&function(){const c=a.author;["avatar","avatarURL"].every(function(g){return g in c})&&(r.BOT_AVATARS[c.avatar]=c.avatarURL,delete c.avatarURL)}()),t.receiveMessage(d.channel_id,d),d}}function v(e,s,i){if(!e?.name||!e?.description)throw new Error(`No name(${e?.name}) or description(${e?.description}) in the passed command (command name: ${e?.name})`);if(e.displayName??=s?.names?.[i]??e.name,e.displayDescription??=s?.names?.[i]??e.description,e.options){if(!Array.isArray(e.options))throw new Error(`Options is not an array (received: ${typeof e.options})`);for(var o=0;o<e.options.length;o++){const n=e.options[o];if(!n?.name||!n?.description)throw new Error(`No name(${n?.name}) or description(${n?.description} in the option with index ${o}`);if(n.displayName??=s?.options?.[o]?.names?.[i]??n.name,n.displayDescription??=s?.options?.[o]?.descriptions?.[i]??n.description,n?.choices){if(!Array.isArray(n?.choices))throw new Error(`Choices is not an array (received: ${typeof n.choices})`);for(var t=0;t<n.choices.length;t++){const r=n.choices[t];if(!r?.name)throw new Error(`No name of choice with index ${t} in option with index ${o}`);r.displayName??=s?.options?.[o]?.choices?.[t]?.names?.[i]??r.name}}}}return e}function E(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:27;if(typeof e!="string")throw new Error("Passed chars isn't a string");if(e?.length<=0)throw new Error("Invalid chars length");let i="";for(let o=0;o<s;o++)i+=e[Math.floor(Math.random()*e.length)];return i}const S={getLoading(){return Math.random()<.01?this.aol:this.loadingDiscordSpinner},getFailure(){return Math.random()<.01?this.fuckyoy:this.linuth},getSuccess(){return""},loadingDiscordSpinner:"a:loading:1105495814073229393",aol:"a:aol:1108834296359301161",linuth:":linuth:1110531631409811547",fuckyoy:":fuckyoy:1108360628302782564"},P={command:"https://cdn.discordapp.com/attachments/1099116247364407337/1112129955053187203/command.png"},T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=T.replace("+/","_-");function I(e,s){if(typeof e!="number")throw new Error(`Passed data isn't a number (received: ${typeof e})`);let i="";for(;e>0;)i=(s?M:T).charAt(e%64)+i,e=Math.floor(e/64);return i}const{meta:{resolveSemanticColor:O}}=h.findByProps("colors","meta"),R=h.findByStoreName("ThemeStore"),m=function(){return parseInt(O(R.theme,A.semanticColors.BACKGROUND_SECONDARY).slice(1),16)},y={author:{username:"TokenUtils",avatar:"command",avatarURL:P.command}};let w;function k(){return window.sendMessage?window.sendMessage?.(...arguments):(w||(w=b(vendetta)),w(...arguments))}var _={meta:vendetta.plugin,patches:[],onUnload(){this.patches.forEach(function(e){return e()}),this.patches=[]},onLoad(){var e=this;const s="Copy Token",i=U.before("render",h.findByProps("ScrollView").View,function(o){try{let t=C.findInReactTree(o,function(a){return a.key===".$UserProfileOverflow"});if(!t||!t.props||t.props.sheetKey!=="UserProfileOverflow")return;const n=t.props.content.props;if(n.options.some(function(a){return a?.label===s}))return;const r=h.findByStoreName("UserStore").getCurrentUser()?.id,u=Object.keys(t._owner.stateNode._keyChildMapping).find(function(a){return t._owner.stateNode._keyChildMapping[a]&&a.match(/(?<=\$UserProfile)\d+/)})?.slice?.(13)||r,l=h.findByProps("getToken").getToken();n.options.unshift({isDestructive:!0,label:s,onPress:function(){try{$.showToast(u===r?"Copied your token":`Copied token of ${n.header.title}`),N.setString(u===r?l:[Buffer.from(u).toString("base64").replaceAll("=",""),I(+Date.now()-129384e4,!0),E(M,27)].join(".")),n.hideActionSheet()}catch(a){console.error(a);let d=!1;try{d=i()}catch{d=!1}alert(`[TokenUtils \u2192 context menu patch \u2192 option onPress] failed. Patch ${d?"dis":"en"}abled
`+a.stack)}}})}catch(t){console.error(t);let n=!1;try{n=i()}catch{n=!1}alert(`[TokenUtils \u2192 context menu patch] failed. Patch ${n?"dis":"en"}abled
`+t.stack)}});this.patches.push(i);try{const o={get(t,n){try{const r={...y,interaction:{name:"/token get",user:h.findByStoreName("UserStore").getCurrentUser()}},{getToken:u}=h.findByProps("getToken");k({loggingName:"Token get output message",channelId:n.channel.id,embeds:[{color:m(),type:"rich",title:"Token of the current account",description:`${u()}`}]},r)}catch(r){console.error(r),alert(`There was an error while exeCuting /token get
`+r.stack)}},login(t,n){try{const r={...y,interaction:{name:"/token login",user:h.findByStoreName("UserStore").getCurrentUser()}},u=new Map(t.map(function(l){return[l.name,l]})).get("token").value;try{k({loggingName:"Token login process message",channelId:n.channel.id,embeds:[{color:m(),type:"rich",title:`<${S.getLoading()}> Switching accounts\u2026`}]},r),h.findByProps("login","logout","switchAccountToken").switchAccountToken(u)}catch(l){console.error(l),k({loggingName:"Token login failure message",channelId:n.channel.id,embeds:[{color:m(),type:"rich",title:`<${S.getFailure()}> Failed to switch accounts`,description:`${l.message}`}]},r)}}catch(r){console.error(r),alert(`There was an error while executing /token login
`+r.stack)}}};[v({type:1,inputType:1,applicationId:"-1",execute:o.get,name:"token get",description:"Shows your current user token"}),v({type:1,inputType:1,applicationId:"-1",execute:o.login,name:"token login",description:"Logs into an account using a token",options:[{required:!0,type:3,name:"token",description:"Token of the account to login into"}]})].forEach(function(t){return e.patches.push(B.registerCommand(t))})}catch(o){console.error(o),alert(`There was an error while loading TokenUtils
`+o.stack)}}};return p.EMBED_COLOR=m,p.authorMods=y,p.default=_,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta.ui,vendetta.commands,vendetta.metro,vendetta.utils,vendetta.metro.common.clipboard,vendetta.patcher,vendetta.ui.toasts);
